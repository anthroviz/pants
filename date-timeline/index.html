
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>chronology</title>
        <meta name="viewport" content="width=device-width">
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.2/raphael-min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.6.0/moment.min.js"></script>
    </head>
    <body>
		<script>
		$(document).ready(function() {
			var chronology = {
				"settings": {
					"startDate": "2010-07-01",
					"startAge": 16,
					"orientation": "vertical",
					"width": 500,
					"height": 2000
				},
				"init": function() {
					var paper = new Raphael(0, 0, chronology.settings.width, chronology.settings.height);

					var middleX = chronology.settings.width / 2;
					var verticalOffset = 40;
					var lineHeight = chronology.settings.height - (verticalOffset * 2);
					var endY = chronology.settings.height - verticalOffset;

					var drawSeg = function(start, finish) {
						return paper.path("M" + start + finish);
					}

					drawSeg(chronology.getPoint(middleX, verticalOffset), chronology.getPoint(middleX, endY));

					var startMoment = moment(chronology.settings.startDate);
					var nowMoment = moment();

					var tickOffset = verticalOffset;

					console.log(nowMoment.diff(startMoment, 'months'));

					var monthsSinceStart = nowMoment.diff(startMoment, 'months');


					function makeTimeline() {
						var year = 50;
						var month = 10;
						var startAge = chronology.settings.startAge;

						function drawTick(tickWidth) {
							var halfTick = tickWidth/2;
							var tickStart = chronology.getPoint(middleX - halfTick, tickOffset);
							var tickEnd = chronology.getPoint(middleX + halfTick, tickOffset);
							drawSeg(tickStart, tickEnd);
						}

						var monthIncrement = lineHeight / monthsSinceStart;


						for (var i = 0; i <= monthsSinceStart; i++) {
							var tick = month;

							var currentMonth = moment(startMoment).add(i, 'months');

							if (currentMonth.month() === 7) {
								console.log(currentMonth);
								tick = year;
								paper.text(230, tickOffset, startAge += 1).attr({'font-size': 18});
							}

							drawTick(tick);
							paper.text(200, tickOffset, currentMonth.format('MM YYYY'));


							tickOffset += monthIncrement;

						}

					}

					makeTimeline();
				},
				"getPoint": function(x, y) {
					return x + "," + y + ",";   
				},
			}

			chronology.init();
		});
		</script>
    </body>
</html>
